# Elasticsearch

В `Elasticsearch` данные хранятся в виде документов JSON. `Elasticsearch` поддерживает хранение вложенных объектов. `Elascticsearch` построен для обработки неструктурированных данных и может автоматически определять типы данных полей документа.

Индекс - это и есть данные.
По умолчанию API — интерфейс Elasticsearch работает на порту `9200`.

## Создание документа

```bash
PUT http://localhost:9200/example1/product/1
{
  "title": "Мой розовый дневник",
  "author": "Роман Одуванчиков",
  "category": "books"
}
```

`Elasticsearch` автоматически создаст индекс `example1` и тип `product` если они еще не существуют.

## Получение существующего документа

Чтобы получить документ нам надо знать индекс, тип и уникальный идентификатор документа.

```bash
GET http://localhost:9200/example1/product/1
```

## Обновление существующего документа

За кулисами `Elasticsearch` происходит извлечение документа, применение изменений и следом повторная вставка документа. Очень дорогая операция.

```bash
POST http://localhost:9200/example1/product/1/_update
{
"doc": {
   "category": "trash"
 }
}
```

## Удаление существующего документа

Для удаления существующего документа нам необходимо использовать HTTP метод `DELETE` передав в него путь.

```bash
DELETE http://localhost:9200/example1/product/1
```


## Поиск

Поисковый запрос в `Elasticsearch` может быть выполнен двумя разными способами:
- Передавая запрос поиска в качестве параметров запроса.
- Передавая запрос поиска в теле запроса.

Простой поисковый запрос с использованием параметров запроса:

```bash
GET example6/product/_search?q=product_name:курткa
```

Предыдущий запрос, переданный как тело запроса, выглядит следующим образом.

```bash
POST example6/product/_search
{
   "query": {
     "match": {
       "product_name" : "курткa"
     }
   }
 }
```

Базовая структура тела запроса:

```bash
{
   "size"    : // Количество документов в ответе. По умолчанию 10.
   "from"    : // Смещение результатов
   "timeout" : // Тайм-аут запроса. По умолчанию его нет.
   "_source" : // Поля которые попадут в ответ.
   "query"   : { // Запрос }
   "aggs"    : { // Агрегация }
   "sort"    : { // Сортировка результата }
}
```
Структура отчета:

```bash
{
  "took"     : // Время потраченное на получение данных
  "timed_out": // Был ли превышен тайм-аут, если он был задан для запроса.
  "_shards": {
    "total": // Количество осколков задействованных при запросе
    "successful": // Количество осколков вернувших успешный результат
    "failed": // Количество осколков с ошибкой
  },
  "hits": {
   "total": // Общее количество документов
   "max_score": // Максимальный балл всех документов
   "hits": [
      // Список документов
    ]
   }
 }
```

[Уроки по Elasticsearch](https://codedzen.ru/category/uroki/elasticsearch/)
